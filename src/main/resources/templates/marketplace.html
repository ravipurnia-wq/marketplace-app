<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechMarket Pro - Electronics & Technology</title>
    <meta name="description" content="Save money. Live better. Shop premium electronics, gadgets, and tech accessories at TechMarket Pro.">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõí</text></svg>">
</head>
<body>
    <!-- Walmart-style Header -->
    <header class="walmart-header">
        <!-- Top Header -->
        <div class="header-top">
            <div class="container">
                <div class="header-links">
                    <a href="/about">About</a>
                    <a href="/contact">Contact</a>
                    <div sec:authorize="hasRole('ADMIN')">
                        <a href="/admin">Admin Panel</a>
                    </div>
                </div>
                <div class="header-links">
                    <span>Save money. Live better.</span>
                </div>
            </div>
        </div>
        
        <!-- Main Header -->
        <div class="header-main">
            <div class="container">
                <div class="header-content">
                    <a href="/" class="logo">TechMarket Pro</a>
                    
                    <div class="search-container">
                        <input type="text" class="search-input" placeholder="Search everything at TechMarket Pro online and in store" id="searchInput">
                        <button class="search-btn" onclick="performSearch()">Search</button>
                    </div>
                    
                    <div class="header-actions">
                        <div sec:authorize="!isAuthenticated()">
                            <a href="/login" class="header-action">
                                <span class="action-icon">üë§</span>
                                <span>Sign In</span>
                            </a>
                            <a href="/register" class="header-action">
                                <span class="action-icon">üìù</span>
                                <span>Register</span>
                            </a>
                        </div>
                        <div sec:authorize="isAuthenticated()">
                            <a href="/profile" class="header-action">
                                <span class="action-icon">üë§</span>
                                <span>Account</span>
                            </a>
                            <a href="/orders" class="header-action">
                                <span class="action-icon">üì¶</span>
                                <span>Orders</span>
                            </a>
                            <a href="/cart" class="header-action">
                                <span class="action-icon">üõí</span>
                                <span>Cart</span>
                            </a>
                            <a href="/logout" class="header-action">
                                <span class="action-icon">üö™</span>
                                <span>Sign Out</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Menu -->
    <nav class="nav-menu">
        <div class="container">
            <div class="nav-content">
                <a href="/" class="nav-item active">Home</a>
                <a href="/products" class="nav-item">All Products</a>
                <a href="/products?category=electronics" class="nav-item">Electronics</a>
                <a href="/products?category=gadgets" class="nav-item">Gadgets</a>
                <a href="/products?category=accessories" class="nav-item">Accessories</a>
            </div>
        </div>
    </nav>
    
    <main class="main-content">
        <div class="container">
            <!-- Hero Banner -->
            <section class="hero-banner">
                <div class="hero-content">
                    <h1 class="hero-title">Electronics that make life easier</h1>
                    <p class="hero-subtitle">Save money. Live better. Shop the latest tech at unbeatable prices.</p>
                    <a href="/products" class="hero-cta">Shop Now</a>
                </div>
            </section>
            
            <!-- Featured Products -->
            <section>
                <div class="section-header">
                    <h2 class="section-title">Featured Products</h2>
                    <p class="section-subtitle">Top picks for electronics & technology</p>
                </div>
                <div class="product-grid" id="product-grid">
                    <div th:each="product : ${products}" class="product-card">
                        <div class="product-image-container">
                            <div class="product-badge">Best Seller</div>
                            <img th:src="${product.imageUrl}" th:alt="${product.name}" onerror="this.src='https://via.placeholder.com/240x200/f0f0f0/666?text=TechMarket+Pro'">
                        </div>
                        <div class="product-content">
                            <h4 class="product-title" th:text="${product.name}">Product Name</h4>
                            
                            <div class="product-rating">
                                <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                <span class="rating-count">(234)</span>
                            </div>
                            
                            <div class="product-price">
                                <span th:text="'$' + ${#numbers.formatDecimal(product.price, 1, 2)}">$0.00</span>
                                <span class="price-strike" th:if="${product.price < 100}">$199.99</span>
                            </div>
                            
                            <div class="product-actions">
                                <div sec:authorize="isAuthenticated()">
                                    <button onclick="addToCart(this)" 
                                            th:data-product-id="${product.id}"
                                            th:data-product-name="${product.name}"
                                            class="btn btn-primary btn-icon">
                                        <span>üõí</span>
                                        <span>Add to cart</span>
                                    </button>
                                    <button onclick="buyNowWithAPI(this)" 
                                            th:data-product-id="${product.id}"
                                            class="btn btn-yellow btn-icon">
                                        <span>üí≥</span>
                                        <span>Buy now</span>
                                    </button>
                                </div>
                                <div sec:authorize="!isAuthenticated()">
                                    <a href="/login" class="btn btn-primary w-full">Sign in to purchase</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>
    
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Shop & Browse</h3>
                    <ul class="footer-links">
                        <li><a href="/products">All Products</a></li>
                        <li><a href="/products?category=electronics">Electronics</a></li>
                        <li><a href="/products?category=gadgets">Gadgets</a></li>
                        <li><a href="/products?category=accessories">Accessories</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Account</h3>
                    <ul class="footer-links">
                        <li><a href="/login">Sign In</a></li>
                        <li><a href="/register">Create Account</a></li>
                        <li><a href="/orders" sec:authorize="isAuthenticated()">Purchase History</a></li>
                        <li><a href="/profile" sec:authorize="isAuthenticated()">Account Settings</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Customer Service</h3>
                    <ul class="footer-links">
                        <li><a href="/contact">Contact Us</a></li>
                        <li><a href="/about">About TechMarket Pro</a></li>
                        <li><a href="#">Return Policy</a></li>
                        <li><a href="#">Help Center</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Get to Know Us</h3>
                    <ul class="footer-links">
                        <li><a href="/about">About TechMarket Pro</a></li>
                        <li><a href="#">Careers</a></li>
                        <li><a href="#">News & Updates</a></li>
                        <li><a href="/api/products">Developer API</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 TechMarket Pro. All rights reserved. | Save money. Live better.</p>
            </div>
        </div>
    </footer>

    <script>
        // Search functionality
        function performSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput.value.trim();
            if (searchTerm) {
                window.location.href = `/products?search=${encodeURIComponent(searchTerm)}`;
            }
        }
        
        // Enter key search
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // Buy Now with API function (same as Quick Buy but with different styling)
        async function buyNowWithAPI(button) {
            const productId = button.getAttribute('data-product-id');
            
            // Add loading state
            const originalHTML = button.innerHTML;
            button.innerHTML = '<span style="font-size: 14px;">‚è≥ Processing...</span>';
            button.disabled = true;
            
            try {
                const response = await fetch('/api/payments/paypal', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        productId: productId
                    })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    button.innerHTML = '<span style="font-size: 14px;">‚úÖ Redirecting...</span>';
                    
                    // Show enhanced product details before redirecting
                    const confirmMessage = `üõí PayPal Checkout - TechMarket Pro\n\n` +
                        `Product: ${result.productName}\n` +
                        `Price: $${result.productPrice}\n` +
                        `Description: ${result.productDescription}\n\n` +
                        `Proceed to secure PayPal checkout?`;
                    
                    if (confirm(confirmMessage)) {
                        // Direct redirect to PayPal (more seamless for Buy Now)
                        window.location.href = result.paypalUrl;
                    } else {
                        button.innerHTML = originalHTML;
                        button.disabled = false;
                    }
                } else {
                    button.innerHTML = '<span style="font-size: 14px; color: red;">‚ùå Failed</span>';
                    alert('Payment failed: ' + result.message);
                    setTimeout(() => {
                        button.innerHTML = originalHTML;
                        button.disabled = false;
                    }, 2000);
                }
            } catch (error) {
                console.error('Error:', error);
                button.innerHTML = '<span style="font-size: 14px; color: red;">‚ùå Error</span>';
                alert('An error occurred while processing the payment.');
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.disabled = false;
                }, 2000);
            }
        }

        // Enhanced buy with API function
        async function buyWithAPI(button) {
            const productId = button.getAttribute('data-product-id');
            
            // Add loading state
            const originalText = button.innerHTML;
            button.innerHTML = '‚è≥ Processing...';
            button.disabled = true;
            
            try {
                const response = await fetch('/api/payments/paypal', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        productId: productId
                    })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    button.innerHTML = '‚úÖ Redirecting...';
                    
                    // Show enhanced product details before redirecting
                    const confirmMessage = `üõí TechMarket Pro - Purchase Confirmation\n\n` +
                        `Product: ${result.productName}\n` +
                        `Price: $${result.productPrice}\n` +
                        `Description: ${result.productDescription}\n\n` +
                        `Click OK to proceed to PayPal checkout with these details pre-filled.`;
                    
                    if (confirm(confirmMessage)) {
                        // Open PayPal with product details
                        window.open(result.paypalUrl, '_blank');
                        
                        // Show success message
                        setTimeout(() => {
                            button.innerHTML = 'üéâ Opened PayPal!';
                            setTimeout(() => {
                                button.innerHTML = originalText;
                                button.disabled = false;
                            }, 2000);
                        }, 500);
                    } else {
                        button.innerHTML = originalText;
                        button.disabled = false;
                    }
                } else {
                    button.innerHTML = '‚ùå Failed';
                    alert('Payment failed: ' + result.message);
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.disabled = false;
                    }, 2000);
                }
            } catch (error) {
                console.error('Error:', error);
                button.innerHTML = '‚ùå Error';
                alert('An error occurred while processing the payment.');
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }, 2000);
            }
        }

        // Add to cart function
        async function addToCart(button) {
            const productId = button.getAttribute('data-product-id');
            const productName = button.getAttribute('data-product-name');
            const originalText = button.innerHTML;
            
            button.innerHTML = '‚è≥ Adding...';
            button.disabled = true;
            
            try {
                const response = await fetch('/api/cart/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `productId=${productId}&quantity=1`
                });
                
                if (response.ok) {
                    button.innerHTML = '‚úÖ Added!';
                    button.style.background = 'linear-gradient(135deg, #27ae60 0%, #229954 100%)';
                    
                    // Show success message
                    setTimeout(() => {
                        alert(`${productName} added to cart successfully!`);
                        button.innerHTML = originalText;
                        button.style.background = '';
                        button.disabled = false;
                    }, 1000);
                } else {
                    throw new Error('Failed to add to cart');
                }
            } catch (error) {
                console.error('Error:', error);
                button.innerHTML = '‚ùå Error';
                alert('Failed to add item to cart. Please try again.');
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }, 2000);
            }
        }

        // Add to wishlist function
        async function addToWishlist(button) {
            const productId = button.getAttribute('data-product-id');
            const originalText = button.innerHTML;
            
            button.innerHTML = 'üíñ Added!';
            button.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
            
            // Simulate API call
            setTimeout(() => {
                alert(`Product ${productId} added to wishlist!`);
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = '';
                }, 1000);
            }, 500);
        }

        // Load products via REST API
        async function loadProducts() {
            try {
                const response = await fetch('/api/products');
                const products = await response.json();
                console.log('üì¶ Products loaded via REST API:', products);
                
                // Update page title with product count
                document.title = `TechMarket Pro - ${products.length} Premium Products Available`;
                
            } catch (error) {
                console.error('‚ùå Error loading products:', error);
            }
        }

        // Enhanced page interactions
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
            
            // Add smooth scroll for navigation
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
            
            // Add loading animation to product cards
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.6s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
</body>
</html>